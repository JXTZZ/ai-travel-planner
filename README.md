# LoTus'AI assistant

一个基于 React + Supabase 的 AI 旅行规划 Web 应用。项目核心目标：整合 DeepSeek 大模型、科大讯飞语音识别、高德地图，实现端到端的个性化行程规划与实时辅助。

---

## 🐳 Docker 一键部署 (推荐)

### 📥 获取镜像文件
下载 `lotus-ai-travel-planner-v1.0.0.tar` (20MB)

### 🚀 在任意电脑上运行 (仅需 2 步)

**Windows PowerShell**:
```powershell
# 1. 导入镜像(位置在apps/web下)
docker load -i lotus-ai-travel-planner-v1.0.0.tar

# 2. 启动应用
docker run -d --name lotus-web -p 80:80 --restart unless-stopped lotus-ai-travel-planner:latest

# 3. 访问应用
start http://localhost
```

**macOS / Linux**:
```bash
# 1. 导入镜像
docker load -i lotus-ai-travel-planner-v1.0.0.tar

# 2. 启动应用
docker run -d --name lotus-web -p 80:80 --restart unless-stopped lotus-ai-travel-planner:latest

# 3. 访问应用 (浏览器打开 http://localhost)
```

### 📦 详细文档
- **部署指南**: [apps/web/DEPLOYMENT_GUIDE.md](./apps/web/DEPLOYMENT_GUIDE.md) - 完整使用说明
- **技术文档**: [docs/DOCKER_DEPLOYMENT.md](./docs/DOCKER_DEPLOYMENT.md) - 开发者参考

---

## 开发快照
- 前端框架：React + TypeScript + Vite (`apps/web`)
- 后端服务：Supabase（Auth、Database、Storage、Edge Functions）
- 外部 API：
  - 语音识别：科大讯飞 WebAPI
  - 地图：高德地图 JS SDK / Web 服务
  - 大模型：硅基流动 DeepSeek-R1-0528-Qwen3-8B
- 部署：Docker 容器 + GitHub Actions + 阿里云镜像仓库

## 本地开发
```bash
# 安装依赖
cd apps/web
npm install

# 本地开发预览
npm run dev

# 构建生产包
npm run build
```
### 环境变量
请将密钥配置到本地 `.env` 文件中，严禁提交真实密钥到版本库。

```bash
# 根目录 .env（示例，供 Supabase CLI / Edge Functions 使用）
SUPABASE_URL=...
SUPABASE_SERVICE_ROLE_KEY=...
DEEPSEEK_API_KEY=...
IFLYTEK_APP_ID=...
IFLYTEK_API_KEY=...
IFLYTEK_API_SECRET=...
AMAP_REST_API_KEY=...
```

```bash
# apps/web/.env.local（前端开发环境变量，供浏览器使用）
VITE_APP_NAME=LoTus'AI assistant
VITE_SUPABASE_URL=...
VITE_SUPABASE_ANON_KEY=...
VITE_AMAP_WEB_KEY=...
VITE_IFLYTEK_APP_ID=...
VITE_IFLYTEK_API_KEY=...
VITE_IFLYTEK_API_SECRET=...
```

> `.env`、`.env.local` 已被 `.gitignore` 忽略，提交前请再次确认未包含真实密钥。

### Supabase Edge Functions 密钥
本地调试 Edge Functions 时可以在 `supabase/.env` 中临时设置，线上部署请使用 `supabase secrets set`：

```bash
supabase secrets set \
  SUPABASE_SERVICE_ROLE_KEY=... \
  DEEPSEEK_API_KEY=... \
  IFLYTEK_APP_ID=... \
  IFLYTEK_API_KEY=... \
  IFLYTEK_API_SECRET=... \
  AMAP_REST_API_KEY=... \
  --project-ref <project-ref>
```

- `VITE_AMAP_WEB_KEY`：前端加载地图使用的 JS API Key（低权限，可暴露）。
- `AMAP_REST_API_KEY`：Edge Function / 服务端调用高德 Web 服务使用的密钥，请勿在前端暴露。
- 科大讯飞凭证需保持三项配套（AppID、APIKey、APISecret），确保 Edge Function 能正确生成签名。

## 代码结构
```
ai-travel-planner/
├── apps/
│   └── web/             # React 前端
├── docs/
│   └── architecture.md  # 架构说明
└── README.md
```

## 下一步
- [x] 初始化前端路由、全局样式、UI 框架
- [x] 集成 Supabase 初始 schema（迁移脚本与 RLS）
- [x] 搭建 Edge Functions 基础骨架（行程规划、语音签名、预算聚合）
- [x] 构建地图、语音、预算模块
- [x] 配置 Docker & GitHub Actions 部署流程

---

## 📖 Web 网站使用指南

### 🚀 快速开始

#### 1. 注册与登录
访问应用后，首次使用需要注册账户：

1. **注册新账户**
   - 点击"注册"按钮
   - 输入邮箱地址和密码（密码至少 6 位）
   - 点击"注册"完成账户创建
   - 系统将自动登录并跳转到主页

2. **登录已有账户**
   - 输入注册时使用的邮箱和密码
   - 可勾选"记住我"保持登录状态（7 天有效）
   - 点击"登录"进入应用

3. **退出登录**
   - 点击右上角头像或用户名
   - 选择"退出登录"

---

### 🎯 核心功能使用

#### 📝 行程规划

##### 方式一：手动创建行程
1. 进入"行程规划"页面
2. 点击"创建行程"按钮
3. 填写行程基本信息：
   - **行程名称**：例如"巴厘岛度假之旅"
   - **目的地**：旅行的主要城市或地点
   - **出行日期**：选择开始日期和结束日期
   - **出行人数**：填写同行人数
   - **预算总额**：设置行程预算（可选）
   - **货币类型**：选择 CNY、USD、EUR 等
4. 点击"创建"保存行程
5. 系统将自动生成行程天数框架

##### 方式二：语音助手创建行程（推荐）
1. 进入"语音助手"页面
2. 点击麦克风图标开始录音
3. 用自然语言描述你的旅行需求，例如：
   ```
   "我想在 12 月去日本东京旅游，预计 5 天 4 夜，
    两个人，预算 1 万元人民币左右，
    想去浅草寺、东京塔、富士山这些景点"
   ```
4. 松开按钮停止录音
5. 系统自动识别语音并生成行程规划
6. 等待 AI 分析后，自动跳转到行程详情页面

**语音识别提示**：
- 录音时长至少 1 秒以上
- 在安静环境下录音效果更佳
- 说话清晰，语速适中
- 包含关键信息：目的地、日期、人数、预算

---

#### 🗓️ 行程详情管理

在行程列表中点击任一行程，进入详情页面：

##### 查看每日安排
- 左侧显示按天划分的行程
- 每天包含多个活动/景点
- 显示活动时间、地点、分类、预估费用

##### 编辑行程信息
1. 点击行程名称旁的"编辑"按钮
2. 修改目的地、日期、预算等信息
3. 点击"保存"更新行程

##### 删除行程
1. 点击"删除行程"按钮
2. 确认删除操作
3. 所有相关的天数、活动、费用记录将一并删除

---

#### 💰 预算管理

##### 设置行程预算
1. 进入"预算管理"页面
2. 在行程列表中找到目标行程
3. 点击"设置预算"按钮
4. 输入预算总额（例如：10000）
5. 选择货币类型（CNY/USD/EUR/JPY/GBP）
6. 点击"保存"

##### 添加支出记录
1. 在行程卡片中点击"添加支出"
2. 填写支出信息：
   - **描述**：例如"酒店住宿"、"晚餐"
   - **金额**：实际花费金额
   - **分类**：选择交通、住宿、餐饮、景点、购物、其他
   - **日期**：支出日期
3. 点击"添加"保存

##### 编辑支出记录
1. 在支出列表中找到需要修改的记录
2. 点击"编辑"按钮
3. 修改金额、描述、分类或日期
4. 点击"保存"更新

##### 删除支出记录
- 点击支出记录旁的"删除"按钮
- 确认删除操作

##### 查看预算分析
系统自动展示：
- **预算进度条**：已花费/预算总额的可视化进度
- **分类统计**：各类别支出占比（饼图或列表）
- **超支警告**：当支出超过预算时显示红色警告标签
- **剩余预算**：实时计算剩余可用金额

---

#### 🗺️ 地图功能

1. 进入"地图"页面
2. 系统自动加载高德地图
3. 功能：
   - **定位当前位置**：点击定位按钮
   - **搜索地点**：在搜索框输入关键词
   - **查看景点**：点击地图标记查看详情
   - **路线规划**：选择起点和终点规划路线

---

#### 📅 日历视图

1. 进入"日历"页面
2. 查看所有行程在日历上的分布
3. 点击日期查看当天的活动安排
4. 快速识别行程冲突或空闲时间

---

#### ⚙️ 个人设置

1. 进入"设置"页面
2. 可配置：
   - 个人资料（昵称、头像）
   - 语言偏好
   - 通知设置
   - 隐私选项
   - 账户安全

---

### 💡 使用技巧

#### 提升语音识别准确率
- ✅ **明确表达需求**：直接说出目的地、日期、预算
- ✅ **分段录音**：复杂需求可分多次录音
- ✅ **检查识别结果**：录音后查看文字转录是否准确
- ❌ **避免环境噪音**：远离空调、风扇等噪音源
- ❌ **避免过快语速**：给系统足够的识别时间

#### 高效管理预算
- 🔹 **及时记录支出**：发生费用后立即添加，避免遗忘
- 🔹 **合理分类**：正确选择支出分类，便于后续分析
- 🔹 **定期检查**：每天查看预算进度，及时调整消费计划
- 🔹 **预留弹性**：设置预算时留出 10-20% 的应急余量

#### 优化行程规划
- 📍 **同区域景点组合**：同一天安排相近的景点，减少交通时间
- 📍 **平衡节奏**：穿插轻松活动和重度游览，避免过度疲劳
- 📍 **预留机动时间**：每天留出 1-2 小时应对突发情况
- 📍 **利用地图**：使用地图功能查看景点实际距离

---

### ❓ 常见问题

#### Q1: 语音识别一直失败怎么办？
**A**: 检查以下几点：
1. 确保浏览器已授权麦克风权限
2. 录音时长至少 1 秒以上
3. 检查网络连接是否稳定
4. 尝试刷新页面重新录音
5. 使用 Chrome/Edge 浏览器以获得最佳兼容性

#### Q2: 创建行程后如何添加具体活动？
**A**: 目前系统通过语音助手自动生成活动安排。未来版本将支持手动添加和编辑单个活动。

#### Q3: 预算显示为 0 是什么原因？
**A**: 需要先点击"设置预算"按钮为行程配置预算总额，否则默认为 0。

#### Q4: 可以邀请朋友一起编辑行程吗？
**A**: 当前版本暂不支持多人协作。此功能已列入开发计划，敬请期待。

#### Q5: 数据会保存多久？
**A**: 所有数据永久保存在 Supabase 云端数据库，只要账户有效就不会丢失。建议定期导出重要行程（功能开发中）。

#### Q6: 如何删除账户？
**A**: 请联系管理员进行账户删除操作。删除后所有行程和支出数据将被永久清除且无法恢复。

---

### 🔐 隐私与安全

- 🔒 **密码安全**：使用 Supabase Auth 加密存储，平台无法查看明文密码
- 🔒 **数据隔离**：RLS（行级安全策略）确保用户只能访问自己的数据
- 🔒 **HTTPS 加密**：所有数据传输使用 TLS 加密
- 🔒 **API 密钥保护**：敏感密钥仅在服务端 Edge Functions 中使用，不会暴露给前端

---

### 📞 技术支持

- **文档中心**: [docs/README.md](./docs/README.md)
- **API 参考**: [docs/API-QUICK-REFERENCE.md](./docs/API-QUICK-REFERENCE.md)
- **架构说明**: [docs/architecture.md](./docs/architecture.md)
- **问题反馈**: 提交 GitHub Issue

---

### 🎉 开始你的旅行计划

现在就访问应用，让 LoTus'AI assistant 成为你的智能旅行助手！

1. 🎤 **语音规划** - 说出想法，AI 自动生成行程
2. 💰 **预算管理** - 实时追踪支出，避免超支
3. 🗺️ **地图导航** - 直观查看景点位置，规划路线
4. 📊 **数据分析** - 支出分类统计，优化旅行预算

**祝你旅途愉快！** ✈️🌍
