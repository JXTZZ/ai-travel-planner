<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase è®¤è¯é—®é¢˜ä¿®å¤æŒ‡å—</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .header p { font-size: 16px; opacity: 0.9; }
        .content { padding: 40px; }
        .step {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .step h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }
        .step ol, .step ul {
            margin-left: 20px;
            line-height: 2;
        }
        .step code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
        }
        .sql-box {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
            margin: 15px 0;
        }
        .btn {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }
        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .success {
            background: #d1f2eb;
            border-left: 4px solid #10b981;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .checklist {
            list-style: none;
            margin-left: 0 !important;
        }
        .checklist li {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .checklist li:before {
            content: "â–¡ ";
            color: #667eea;
            font-size: 20px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Supabase è®¤è¯é—®é¢˜ä¿®å¤</h1>
            <p>3 æ­¥è§£å†³æ³¨å†Œç™»å½•é—®é¢˜</p>
        </div>
        
        <div class="content">
            <div class="step">
                <h3>æ­¥éª¤ 1ï¼šå…³é—­é‚®ç®±éªŒè¯ï¼ˆæœ€é‡è¦ï¼ï¼‰</h3>
                <p style="margin-bottom: 15px;">è¿™æ˜¯æœ€å¸¸è§çš„é—®é¢˜åŸå› ã€‚å¼€å‘é˜¶æ®µå»ºè®®å…³é—­é‚®ç®±éªŒè¯ã€‚</p>
                <ol>
                    <li>è®¿é—® <a href="https://supabase.com/dashboard/project/zhugdvqgkqpmxhixtqaj/auth/providers" target="_blank">Auth Providers è®¾ç½®</a></li>
                    <li>æ‰¾åˆ° <strong>Email</strong> æä¾›å•†ï¼Œç‚¹å‡»å±•å¼€</li>
                    <li><strong>å–æ¶ˆå‹¾é€‰</strong> "Confirm email" é€‰é¡¹</li>
                    <li>ç‚¹å‡» <strong>Save</strong> æŒ‰é’®ä¿å­˜</li>
                </ol>
                <div class="warning">
                    <strong>âš ï¸ ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ</strong><br>
                    å¼€å¯é‚®ç®±éªŒè¯åï¼Œç”¨æˆ·å¿…é¡»ç‚¹å‡»éªŒè¯é‚®ä»¶æ‰èƒ½ç™»å½•ã€‚ä½† Supabase é»˜è®¤ä¸ä¼šçœŸæ­£å‘é€é‚®ä»¶ï¼ˆé™¤éé…ç½®äº† SMTPï¼‰ï¼Œå¯¼è‡´ç”¨æˆ·æ— æ³•å®ŒæˆéªŒè¯ã€‚
                </div>
            </div>

            <div class="step">
                <h3>æ­¥éª¤ 2ï¼šé…ç½® URL é‡å®šå‘</h3>
                <ol>
                    <li>åœ¨åŒä¸€ä¸ª <a href="https://supabase.com/dashboard/project/zhugdvqgkqpmxhixtqaj/auth/url-configuration" target="_blank">URL Configuration</a> é¡µé¢</li>
                    <li>æ‰¾åˆ° <strong>Redirect URLs</strong></li>
                    <li>æ·»åŠ ä»¥ä¸‹ URLï¼š
                        <div class="sql-box">http://localhost:5173/**<br>http://localhost:5173</div>
                    </li>
                    <li>è®¾ç½® <strong>Site URL</strong> ä¸ºï¼š
                        <div class="sql-box">http://localhost:5173</div>
                    </li>
                    <li>ç‚¹å‡» <strong>Save</strong></li>
                </ol>
            </div>

            <div class="step">
                <h3>æ­¥éª¤ 3ï¼šæ·»åŠ è‡ªåŠ¨åˆ›å»º Profile çš„è§¦å‘å™¨</h3>
                <p style="margin-bottom: 15px;">ç”¨æˆ·æ³¨å†Œåè‡ªåŠ¨åˆ›å»º profile è®°å½•ã€‚</p>
                <ol>
                    <li>è®¿é—® <a href="https://supabase.com/dashboard/project/zhugdvqgkqpmxhixtqaj/editor" target="_blank">SQL Editor</a></li>
                    <li>ç‚¹å‡» <strong>+ New query</strong></li>
                    <li>å¤åˆ¶ä¸‹é¢çš„ SQL å¹¶æ‰§è¡Œï¼š</li>
                </ol>
                <div class="sql-box">-- åˆ›å»ºè‡ªåŠ¨åˆ›å»º profile çš„å‡½æ•°
create or replace function public.handle_new_user()
returns trigger
language plpgsql
security definer set search_path = public
as $$
begin
  insert into public.profiles (id, display_name, avatar_url, preferences)
  values (
    new.id,
    coalesce(new.raw_user_meta_data->>'display_name', split_part(new.email, '@', 1)),
    new.raw_user_meta_data->>'avatar_url',
    '{}'::jsonb
  );
  return new;
end;
$$;

-- åˆ é™¤æ—§è§¦å‘å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
drop trigger if exists on_auth_user_created on auth.users;

-- åˆ›å»ºè§¦å‘å™¨
create trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();</div>
                <ol start="4">
                    <li>ç‚¹å‡» <strong>Run</strong> æ‰§è¡Œ</li>
                    <li>çœ‹åˆ° "Success" æ¶ˆæ¯å³å¯</li>
                </ol>
            </div>

            <div class="step">
                <h3>æ­¥éª¤ 4ï¼šæµ‹è¯•æ³¨å†Œç™»å½•</h3>
                <p style="margin-bottom: 15px;">ç°åœ¨æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚</p>
                <ul class="checklist">
                    <li>æ‰“å¼€ <a href="http://localhost:5173/debug" target="_blank">http://localhost:5173/debug</a> æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯</li>
                    <li>è®¿é—® <a href="http://localhost:5173/auth" target="_blank">http://localhost:5173/auth</a> æ³¨å†Œé¡µé¢</li>
                    <li>ä½¿ç”¨æµ‹è¯•é‚®ç®±æ³¨å†Œï¼ˆå¦‚ï¼štest@example.comï¼Œå¯†ç ï¼š123456ï¼‰</li>
                    <li>æ³¨å†ŒæˆåŠŸååº”è¯¥è‡ªåŠ¨è·³è½¬åˆ° /planner é¡µé¢</li>
                    <li>é€€å‡ºç™»å½•åå†æ¬¡ç™»å½•ï¼Œæµ‹è¯•ç™»å½•åŠŸèƒ½</li>
                </ul>
                <div class="success">
                    <strong>âœ… æ³¨å†ŒæˆåŠŸçš„è¡¨ç°ï¼š</strong><br>
                    - æ˜¾ç¤º"æ³¨å†ŒæˆåŠŸï¼"æ¶ˆæ¯<br>
                    - è‡ªåŠ¨è·³è½¬åˆ°è§„åˆ’ä¸­å¿ƒé¡µé¢<br>
                    - åœ¨ <a href="https://supabase.com/dashboard/project/zhugdvqgkqpmxhixtqaj/auth/users" target="_blank">Users åˆ—è¡¨</a>ä¸­çœ‹åˆ°æ–°ç”¨æˆ·
                </div>
            </div>

            <div class="step">
                <h3>å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ</h3>
                <ul>
                    <li><strong>é”™è¯¯ï¼š</strong> "Invalid login credentials"<br>
                        <strong>åŸå› ï¼š</strong> å¯†ç é”™è¯¯æˆ–ç”¨æˆ·ä¸å­˜åœ¨<br>
                        <strong>è§£å†³ï¼š</strong> ç¡®è®¤é‚®ç®±å¯†ç æ­£ç¡®ï¼Œæˆ–æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨ Dashboard ä¸­
                    </li>
                    <li><strong>é”™è¯¯ï¼š</strong> "Email not confirmed"<br>
                        <strong>åŸå› ï¼š</strong> é‚®ç®±éªŒè¯æœªå…³é—­<br>
                        <strong>è§£å†³ï¼š</strong> è¿”å›æ­¥éª¤ 1ï¼Œå…³é—­é‚®ç®±éªŒè¯
                    </li>
                    <li><strong>é”™è¯¯ï¼š</strong> "User already registered"<br>
                        <strong>åŸå› ï¼š</strong> é‚®ç®±å·²è¢«ä½¿ç”¨<br>
                        <strong>è§£å†³ï¼š</strong> åˆ‡æ¢åˆ°ç™»å½•æ ‡ç­¾é¡µç›´æ¥ç™»å½•
                    </li>
                    <li><strong>ç°è±¡ï¼š</strong> æ³¨å†ŒæˆåŠŸä½†ä¸è·³è½¬<br>
                        <strong>åŸå› ï¼š</strong> éœ€è¦é‚®ç®±éªŒè¯ä½†æœªé…ç½®<br>
                        <strong>è§£å†³ï¼š</strong> å…³é—­é‚®ç®±éªŒè¯ï¼ˆæ­¥éª¤ 1ï¼‰
                    </li>
                </ul>
            </div>

            <div class="success">
                <strong>ğŸ‰ å®Œæˆï¼</strong><br>
                å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨çš„è®¤è¯ç³»ç»Ÿåº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰çš„é”™è¯¯ä¿¡æ¯ã€‚
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <a href="http://localhost:5173/debug" class="btn" target="_blank">æ‰“å¼€è°ƒè¯•é¡µé¢</a>
                <a href="http://localhost:5173/auth" class="btn" target="_blank">æ‰“å¼€ç™»å½•é¡µé¢</a>
                <a href="https://supabase.com/dashboard/project/zhugdvqgkqpmxhixtqaj/auth/providers" class="btn" target="_blank">æ‰“å¼€ Auth è®¾ç½®</a>
            </div>
        </div>
    </div>

    <script>
        // è‡ªåŠ¨æ£€æŸ¥å¹¶æç¤º
        setTimeout(() => {
            const checkDone = confirm('æ˜¯å¦å·²å®Œæˆæ­¥éª¤ 1ï¼ˆå…³é—­é‚®ç®±éªŒè¯ï¼‰ï¼Ÿè¿™æ˜¯æœ€é‡è¦çš„æ­¥éª¤ï¼');
            if (checkDone) {
                alert('å¤ªå¥½äº†ï¼ç°åœ¨å¯ä»¥æµ‹è¯•æ³¨å†Œç™»å½•åŠŸèƒ½äº†ã€‚\n\nç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è®¿é—®æµ‹è¯•é¡µé¢ã€‚');
            } else {
                alert('è¯·åŠ¡å¿…å…ˆå®Œæˆæ­¥éª¤ 1ï¼Œå¦åˆ™æ³¨å†Œåæ— æ³•ç™»å½•ï¼');
            }
        }, 2000);
    </script>
</body>
</html>
