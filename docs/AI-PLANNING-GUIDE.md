# AI 智能行程规划使用指南

## 📋 功能概述

系统提供了**三种方式**使用 AI 生成旅行行程：

1. **AI 智能规划**（行程规划页面）- 快速创建新行程
2. **AI 生成详细行程**（行程详情页面）- 为现有行程生成详细安排
3. **语音助手**（语音助手页面）- 通过语音描述生成行程

---

## 🚀 使用方法

### 方法 1：AI 智能规划（创建新行程）

**适用场景**：从零开始规划一次旅行

**操作步骤**：
1. 访问**行程规划页面**：http://localhost:5174/planner
2. 点击右上角的**"AI 智能规划"**按钮（蓝色主按钮）
3. 在弹出的对话框中输入旅行需求
4. 点击**"生成行程"**按钮
5. 等待 5-10 秒，AI 生成完成后自动跳转到详细行程页面

**输入示例**：
```
我想去杭州玩3天，预算2000元，2个人，
喜欢自然风景和美食，不想太累，
希望包含西湖、灵隐寺、宋城等景点
```

**AI 生成内容**：
- ✅ 完整的行程标题
- ✅ 目的地、日期、人数、预算
- ✅ 每日详细安排（景点、时间、活动）
- ✅ 交通方式建议
- ✅ 餐厅推荐
- ✅ 住宿区域建议
- ✅ 费用明细

---

### 方法 2：AI 生成详细行程（现有行程增强）

**适用场景**：已创建行程框架，需要 AI 填充详细内容

**操作步骤**：
1. 在**行程规划页面**点击某个行程的**"查看详情"**
2. 进入行程详情页面后，点击右上角的**"AI 生成详细行程"**按钮
3. 系统会自动根据现有行程信息（目的地、日期、人数、预算）生成提示词
4. 可以补充更多需求（如偏好、兴趣、特殊要求）
5. 点击**"生成详细行程"**按钮
6. AI 会更新当前行程，添加每日详细安排

**优势**：
- 保留原有行程的基本信息
- 可以多次生成，不断优化
- 适合渐进式规划

**输入示例**：
```
系统自动生成：请为我生成详细的行程安排：目的地：杭州，3天，2人，预算2000元

你可以补充：喜欢摄影和咖啡馆，希望有充足的自由活动时间，
不想每天起太早，偏好小众景点而不是热门打卡地
```

---

### 方法 3：语音助手（语音输入）

**适用场景**：移动端或不方便打字时

**操作步骤**：
1. 访问**语音助手页面**：http://localhost:5174/voice
2. 点击**"开始录音"**按钮
3. 用语音描述您的旅行需求
4. 点击**"停止录音"**
5. 等待语音识别完成
6. 查看识别结果，确认无误后点击**"生成行程"**
7. AI 生成完成后自动跳转到行程详情页面

**语音输入示例**：
```
我想在五一假期去成都玩四天，预算三千元左右，
主要想体验当地美食和文化，比如火锅、串串、宽窄巷子这些，
不想安排太紧张，希望每天有一些自由活动的时间
```

---

## 💡 最佳实践

### 1. 提供详细信息

**必需信息**：
- 目的地（城市或地区）
- 天数（几天几夜）
- 预算（大致范围）

**建议补充**：
- 人数和同行人类型（朋友/家人/情侣/独自）
- 兴趣偏好（美食/风景/历史/购物/摄影）
- 体力要求（轻松/适中/紧凑）
- 特殊需求（带老人/带小孩/无障碍设施）

### 2. 描述要具体

❌ **不推荐**：
```
我想去北京玩
```

✅ **推荐**：
```
我想在暑假去北京玩5天，预算4000元，2个成年人，
喜欢历史文化景点，想去故宫、长城、颐和园，
希望包含烤鸭等特色美食，住宿偏好四星级酒店
```

### 3. 多次优化

对于重要的旅行，可以：
1. 先用 AI 生成初版行程
2. 查看详情，记录不满意的地方
3. 再次使用"AI 生成详细行程"功能
4. 补充更具体的需求和调整建议
5. 重新生成更符合期望的版本

---

## 🔧 技术说明

### AI 模型
- **使用模型**：DeepSeek-V3
- **调用接口**：SiliconFlow API
- **平均响应时间**：5-10 秒
- **输出格式**：结构化 JSON

### 数据存储
AI 生成的行程会自动存储到数据库，包括：
- `trips` 表：行程基本信息
- `trip_days` 表：每日行程概要
- `trip_activities` 表：每日具体活动

### 生成内容结构

```json
{
  "title": "杭州3日休闲游",
  "destination": "杭州",
  "startDate": "2025-11-15",
  "endDate": "2025-11-17",
  "partySize": 2,
  "budgetTotal": 2000,
  "budgetCurrency": "CNY",
  "notes": "以西湖周边为主，注重美食体验",
  "days": [
    {
      "dayIndex": 1,
      "date": "2025-11-15",
      "summary": "抵达杭州，西湖游览，品尝本帮菜",
      "activities": [
        {
          "title": "抵达杭州东站",
          "location": "杭州东站",
          "startTime": "10:00",
          "endTime": "10:30",
          "category": "transportation",
          "estimatedCost": 0,
          "notes": "高铁到达"
        },
        {
          "title": "入住酒店",
          "location": "西湖区",
          "startTime": "11:00",
          "endTime": "12:00",
          "category": "accommodation",
          "estimatedCost": 300,
          "notes": "建议住在西湖附近"
        },
        {
          "title": "午餐：楼外楼",
          "location": "孤山路30号",
          "startTime": "12:30",
          "endTime": "14:00",
          "category": "dining",
          "estimatedCost": 200,
          "notes": "品尝西湖醋鱼等特色菜"
        },
        {
          "title": "西湖游船",
          "location": "西湖",
          "startTime": "14:30",
          "endTime": "16:30",
          "category": "sightseeing",
          "estimatedCost": 100,
          "notes": "推荐三潭印月线路"
        }
      ]
    }
  ]
}
```

---

## ❓ 常见问题

### Q1: AI 生成的行程不满意怎么办？

**方案 1**：重新生成
- 点击"AI 生成详细行程"
- 补充更具体的需求和调整建议
- 重新生成

**方案 2**：手动编辑
- 点击"编辑"按钮
- 修改行程基本信息
- 保存更新

**方案 3**：删除重建
- 删除当前行程
- 返回行程规划页面
- 使用更详细的描述重新生成

### Q2: 生成速度慢怎么办？

**原因**：
- AI 模型处理需要时间（5-10秒）
- 网络延迟
- 服务器负载

**建议**：
- 耐心等待，不要重复点击
- 查看浏览器控制台是否有错误
- 如果超过 30 秒仍无响应，刷新页面重试

### Q3: 生成失败显示"解析失败"怎么办？

**可能原因**：
- AI 返回的内容格式不正确
- 网络请求失败
- 数据库连接问题

**解决方法**：
1. 查看弹出的"AI 生成的内容"对话框
2. 复制原始内容
3. 联系开发者反馈问题
4. 或手动创建行程并填写内容

### Q4: 可以生成国外行程吗？

可以！只需在描述中指定目的地即可，例如：
```
我想去日本东京玩5天，预算8000元，
喜欢动漫和美食，想去秋叶原、浅草寺、
品尝拉面和寿司，需要购物时间
```

### Q5: 生成的预算准确吗？

AI 生成的预算是**估算值**，仅供参考。实际费用会受以下因素影响：
- 旅游淡旺季
- 酒店星级选择
- 餐厅档次
- 交通方式
- 购物消费

建议在实际预订时以市场价格为准。

---

## 🛠️ 技术支持

### 查看日志

打开浏览器开发者工具（F12），查看 Console 标签：
- `[plan-itinerary]` - Edge Function 日志
- `[geocode]` - 地图定位日志
- `AI generation error` - 前端错误日志

### 报告问题

如遇到问题，请提供以下信息：
1. 操作步骤
2. 输入的提示词
3. 控制台错误信息（截图或复制）
4. 浏览器类型和版本

---

## 📊 功能对比

| 功能 | 位置 | 输入方式 | 适用场景 | 特点 |
|------|------|----------|----------|------|
| **AI 智能规划** | 行程规划页面 | 文字 | 快速创建新行程 | 从零开始，完整规划 |
| **AI 生成详细行程** | 行程详情页面 | 文字 | 现有行程增强 | 保留框架，填充细节 |
| **语音助手** | 语音助手页面 | 语音 | 移动端/懒得打字 | 语音输入，实时转写 |
| **手动创建** | 行程规划页面 | 表单 | 完全自定义 | 灵活性最高 |

---

## 🎯 使用建议

### 新手推荐流程

1. **第一次使用**：选择"AI 智能规划"
   - 快速体验 AI 规划能力
   - 了解生成的行程结构

2. **查看生成结果**：进入行程详情
   - 检查行程是否符合预期
   - 记录需要调整的地方

3. **优化行程**：使用"AI 生成详细行程"
   - 补充具体需求
   - 重新生成优化版本

4. **手动微调**：使用"编辑"功能
   - 修改不满意的细节
   - 添加个性化内容

### 高级用户技巧

1. **分阶段规划**
   - 先确定大框架（目的地、天数、预算）
   - 再用 AI 生成详细安排
   - 最后手动添加特色内容

2. **组合使用多种方式**
   - 语音助手快速记录想法
   - AI 智能规划生成初稿
   - 手动编辑精细调整

3. **保存多个版本**
   - 为同一目的地生成多个方案
   - 对比选择最满意的版本
   - 可以混合不同方案的亮点

---

## 📅 更新日志

- **2025-11-07**: 
  - 新增"AI 智能规划"功能（行程规划页面）
  - 新增"AI 生成详细行程"功能（行程详情页面）
  - 优化 Edge Function，支持更新现有行程
  - 改进错误处理和用户反馈

---

**祝您旅途愉快！** 🎉✈️🗺️
